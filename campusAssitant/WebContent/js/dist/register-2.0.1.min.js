define(["jquery","common","util/validate","config"],function(e,r,t){String.prototype.getQueryString=function(e){var r,t=new RegExp("(^|&|\\?)"+e+"=([^&]*)(&|$)");return(r=this.match(t))?unescape(r[2]):null};var s=location.search.getQueryString("recommend"),i=/^[0-9a-zA-Z]*$/g;null!=s&&i.test(s)&&s.length>5&&s.length<10&&(e("#zzu_referrer_tel").val(s),e("#zzu_referrer_tel").attr("readOnly","readonly")),e("#zzu_captcha_btn,#zzu_captcha_img").on("click",function(){e("#zzu_captcha_img").attr("src","/i/n/images/captcha.jpg?"+Math.random())}),e("#zzu_captcha_btn").trigger("click"),e("#zzu_user_tel").on("blur",function(){var s=e("#zzu_user_tel").val();if(!t.isNotNull(s))return void e("#zzu_error").empty().html("手机号码不能为空");if(!t.isPhoneNumber(s))return void e("#zzu_error").empty().html("手机号码格式不正确");var i=function(r){return"1021"==r.code?void e("#zzu_error").empty().html(r.message):void 0};r.ajaxUtil("n/checkUser/isRegisterPlatform.json",{tel:s},"get",i)}),e("#zzu_register_bottom").on("click",function(){var s,i,c,a=e("#zzu_user_tel").val(),n=e("#zzu_user_password").val(),o=e("#zzu_referrer_tel").val();if(!t.isNotNull(a))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("手机号码不能为空");if(!t.isPhoneNumber(a))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("手机号码格式不正确");if("true"!=t.isPas(n))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html(t.isPas(n));if(null!=o&&o.length>6&&!t.isPhoneNumber(o))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("推荐人手机号格式不正确");if(!isDevEnv){var l=r.getItemSession("registerUserTel");if(!t.isNotNull(l)&&l!=a)return e("#zzu_error").empty().html("手机号验证码不正确"),void e("#zzu_captcha_btn").trigger("click");if(s=e("#zzu_captcha").val(),!t.isNotNull(s))return e("#zzu_error").empty().html("图形验证码不能为空"),void e("#zzu_captcha_btn").trigger("click");if(i=e.trim(e("#zzu_iphone_code").val()),!t.isNotNull(i))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("手机号验证码不能为空");var _=r.getItemSession("zzu_get_code");if(!t.isNotNull(_))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("手机号验证码已失效，请重新发送")}var g=e("#zzu_agree");if(g&&!g.is(":checked"))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("用户需要同意平台使用协议");e("#zzu_error").empty();var j=e("#zzu_check_yh");j&&j.is(":checked")&&(c="96688");var h={mobile:a,password:n,introduce:c,recommendCode:o,smscode:i},m=function(t){"1111"==t.code?(r.removeItemSession("registerUserTel"),r.goUrl("open_rernittance.html")):(e("#zzu_user_password").val(""),e("#zzu_captcha_btn").trigger("click"),r.showMessage(t.message))};r.ajaxUtil("n/user/register.json",h,"POST",m)}),e("#zzu_get_code").on("click",function(){if(!isDevEnv){var s=e("#zzu_user_tel").val();if(!t.isPhoneNumber(s))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_error").empty().html("手机号码格式不正确");var i=e("#zzu_captcha").val();if(!t.isNotNull(i))return e("#zzu_error").empty().html("图形验证码不能为空"),void e("#zzu_captcha_btn").trigger("click");var c=function(t){"1111"==t.code?(r.setItemSession("registerUserTel",s),r.sendValidateSMS(s,"zzu_get_code","zzu_captcha_btn")):(r.showMessage(t.message),e("#zzu_captcha_btn").trigger("click"))};r.ajaxUtil("n/captcha/check.json",{captcha:i},"POST",c)}})});