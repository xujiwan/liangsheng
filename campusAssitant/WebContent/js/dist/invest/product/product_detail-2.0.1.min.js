define(["jquery","common","page","util/jquery.huifu","scrollbar"],function(a,e,t,s){function n(t,s){var r=t||1,o=s||5,i=(r-1)*o,l=o,c={start:i,length:l,columns:[{data:"ID",name:"ID"},{data:"STAGES_ASSESTS",name:"STAGES_ASSESTS"},{data:"CREATE_TIME",name:"CREATE_TIME",orderable:!0},{data:"TEL",name:"TEL"}],order:[{column:"2",dir:"desc"}]};e.ajaxUtil("n/loan/investlist.json",{loanId:_,pageData:JSON.stringify(c)},"POST",function(t){e.putTemplete("zzu_records_tem",t.data,"zzu_records_info"),a("#zzu_total_num").html(t.recordsFiltered),a("#zzu_total_amt").html(t.totalAmount),a.zzuPage({pageId:"pageContainer",pageNo:r,pageSize:o,totalCount:t.recordsFiltered,load:n})})}var r,o,i,l,_,c,d=window.location.hash;if(d){_=d.substring(d.indexOf("#")+1,d.lastIndexOf("#"));var j,m=new Array,h=function(){var t=new Array;j>m.length&&(j=m.length),2>j&&(j=2);for(var s=j-2;j>s;s++)t.push(m[s]);t.length>0?(a("#zzu_cash_coupon_info").show(),e.putTemplete("zzu_cash_ticket",t,"zzu_cash_ticketBox"),a(".zzu-cash-ticketOne").on("click",p)):a("#zzu_cash_coupon_info").hide()};a("#zzu_cash_coupon_info").hide();var u=function(e){if(e&&e.length>0){m.length=0;var t=a(".zzu-number-text").val();a.each(e,function(a,e){5==e.AMOUNT&&t>=1e3&&m.push(e),10==e.AMOUNT&&t>=2e3&&m.push(e),25==e.AMOUNT&&t>=5e3&&m.push(e),50==e.AMOUNT&&t>=1e4&&m.push(e)}),m.length>0&&(j=2,h())}},w=function(t){if("1"!==i&&1!==i){var s=a("body").data("available_case_value_array");s?u(s):e.ajaxUtil("n/cashCoupon/getcoupon.json",null,"GET",function(e){a("body").data("available_case_value_array",e),u(e)})}},f=function(t,s){a("#zzu_error").empty();var n=t.val();if(n){if(/^[1-9]{1}\d*$/g.test(n)){var i=parseFloat(e.rmoney(r));return n=parseFloat(n),n>i?(a("#investment_revenue").addClass("zzu-hidden"),a("#zzu_error").empty().html("投资金额不能大于剩余可投金额"),!1):(a("#zzu_text_emphasis").empty().html(e.formatMoney(""+n/e.rmoney(o)*l)),a("#investment_revenue").removeClass("zzu-hidden"),n>=1e3&&"callInitiat"!=s&&w(n),1e3>=n&&(a("#zzu_cash_coupon_info").hide(),a("#zzu_cash_id").val(""),a("#zzu_cash_amt").val("")),!0)}}else a("#investment_revenue").addClass("zzu-hidden")},v=function(t){t&&(r=t.availInvest,o=t.SUM,i=t.payment_uses,l=t.TOTAL_INTEREST,c=t.avlBal,a("#zzu_remaining_money").html(r),a(".zzu-emphasis-million").html(t.thousandProfit),a(".zzu-audit-time").html(t.passTime),a("#zzu_usable_amt").html(c),c&&a("#zzu_usable_amt_span").removeClass("zzu-hidden"),e.putTemplete("zzu_load_title_tem",t,"zzu_load_title"),e.putTemplete("zzu_detail_info_tem",t,"zzu_detail_info"),a(".scrollbar-inner").scrollbar(),f(a(".zzu-number-text")))};e.ajaxUtil("n/loan/detail.json",{loadId:_},"GET",v),a("#zzu_prev").on("click",function(){2>=j||(j--,h())}),a("#zzu_next").on("click",function(){j++,h()});var p=function(){a("#zzu_cash_id").val()==a(this).attr("data")?(a(this).css("background-color","#ed272e"),a("#zzu_cash_id").val(""),a("#zzu_cash_amt").val("")):(a("#zzu_cash_id").val(a(this).attr("data")),a("#zzu_cash_amt").val(a(this).attr("data-amount")),a(this).siblings().css("background-color","#ed272e"),a(this).css("background-color","#f2a5a8"))};e.ajaxUtil("n/loan/repayplan.json",{loadId:_},"GET",function(a){a&&e.putTemplete("zzu_striped_tem",a,"zzu_triped_info")}),n(),e.ajaxUtil("n/loan/auditfiles.json",{loanId:_},"GET",function(e){e.creditReport&&a("#zzu_credit_href").attr("href",e.creditReport).attr("target","_blank"),e.incomeProof&&a("#zzu_credit_href").attr("href",e.incomeProof).attr("target","_blank"),e.jobProof&&a("#zzu_credit_href").attr("href",e.jobProof).attr("target","_blank"),e.idProof&&a("#zzu_credit_href").attr("href",e.idProof).attr("target","_blank")}),a(".zzu-number-text").on("keyup change",function(){f(a(this))}),a("#zzu_minus").on("click",function(){var e=a(".zzu-number-text").val();if(e){e=parseFloat(e);var t=e-100;t>0?a(".zzu-number-text").val(t):a(".zzu-number-text").val(""),f(a(".zzu-number-text"))}}),a("#zzu_add").on("click",function(){var e=a(".zzu-number-text").val();e=e?parseFloat(e):0,a(".zzu-number-text").val(e+100),f(a(".zzu-number-text"))}),d.indexOf("zzu-disable")>0?(a("#zzu_search_form").hide(),a("#zzu_loan_repaymen").show()):(a("#zzu_search_form").removeClass("zzu-hidden"),a("#zzu_loan_repaymen").addClass("zzu-hidden")),a("#zzu_btn_invest").on("click",function(){var t=a("#zzu_loan_deal");if(t&&!t.is(":checked"))return void a("#zzu_error").empty().html("请阅读并同意签署《借贷协议》");if(f(a(".zzu-number-text"),"callInitiat")){var n=a(".zzu-number-text").val(),r=a("#zzu_cash_amt").val(),o=function(e){if("1111"==e.code){var t={load_id:_,transAmt:n,cashAmount:r,cashId:a("#zzu_cash_id").val()};s.callInitiativeTender(t)}else a("#zzu_error").empty().html(e.message)};e.ajaxUtil("invest/checkinvest.json",{transAmt:n,cashAmount:r},"POST",o)}})}});