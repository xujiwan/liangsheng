define(["jquery","common","util/validate","util/jquery.huifu","bs","accountsPublic","config"],function(e,s,a,_){var o,n;s.ajaxUtil("userinfo/getUserInfo.json",null,"GET",function(s){e(".zzu-panel-heading-one").css("background-color","#ed272e").find("h3").css("color","white"),e(".zzu-panel-heading-one").find(".zzu-tag").hide(),e(".zzu-panel-heading-one").attr("type","open");var _=s.zzu_USER_USER_NICKNAME;n=s.zzu_USER_TEL;var i=s.zzu_USER_EMAIL;o=s.zzu_USER_WECHAT,e("#zzu_old_name").html(_),e("#zzu_old_phone").html(n.replace(n.substr(3,5),"*****")),e("#zzu_user_wechat").val(o).attr("disable","disable"),a.isNotNull(i)?e("#zzu_old_email").html(i):e("#zzu_old_email").html("您还没添加邮箱").siblings().addClass("zzu-hidden")}),e(".panel-heading").on("click",function(){return e(".panel-heading").css("background-color","white"),e(".panel-heading").find("h3").css("color","black"),e(this).css("background-color","#ed272e"),e(this).find("h3").css("color","white"),"open"==e(this).attr("type")?(e(this).find(".zzu-tag").show(),void e(this).removeAttr("type")):(e(this).find(".zzu-tag").hide(),void e(this).attr("type","open"))});var i=function(s,a){s="#"+s,e(s).html(a),setTimeout(function(){e(s).empty()},3e3)};e("#zzu_update_name").on("click",function(){var _=e("#zzu_user_name").val();if(a.isNotNull(_)){var o={userNick:_},n=function(a){"1111"==a.code&&(e("#zzu_old_name").html(_),e("#zzu_user_name").val(""),s.setItemSession("nikeName",_),i("zzu_user_err","修改成功")),"0000"==a.code&&(e("#zzu_user_name").focus(),i("zzu_user_err","修改失败"))};s.ajaxUtil("userinfo/modifyUserName.json",o,"POST",n)}}),e("#zzu_update_pass").on("click",function(){var _=e("#zzu_old_pass").val(),o=e("#zzu_new_pass").val(),n=e("#zzu_new_pass_two").val();if("true"==a.isPas(_)){if(_==o)return i("zzu_pass_err","新密码不能和原密码相同！"),e("#zzu_new_pass,#zzu_new_pass_two").val(""),void e("#zzu_new_pass").focus();if("true"==a.isPas(o))if(o===n){var r=function(s){e("#zzu_old_pass,#zzu_new_pass,#zzu_new_pass_two").val(""),"1111"==s.code?i("zzu_pass_err","修改成功"):i("zzu_pass_err",s.message)};s.ajaxUtil("userinfo/updatePassword.json",{oldPwd:_,newPwd:o},"POST",r)}else e("#zzu_new_pass,#zzu_new_pass_two").val(""),e("#zzu_new_pass").focus(),i("zzu_pass_err","两次输入的新密码不同！");else e("#zzu_new_pass").val("").focus(),i("zzu_pass_err",a.isPas(o))}else e("#zzu_old_pass").val("").focus(),i("zzu_pass_err",a.isPas(_))}),e("#zzu_update_phone").on("click",function(){var _=e("#zzu_old_phone_input").val(),o=e("#zzu_new_phone").val(),n=e("#zzu_graph_code").val(),r=e("#zzu_phone_code").val();if(!a.isPhoneNumber(_))return e("#zzu_old_phone_input").val("").focus(),void i("zzu_phone_err","请正确填写您注册时用的手机号码");if(o==_)return e("#zzu_new_phone").val("").focus(),void i("zzu_phone_err","新手机号码不能和原手机号相同");if(!a.isPhoneNumber(o))return e("#zzu_new_phone").val("").focus(),void i("zzu_phone_err","新手机号码格式不正确");if(!isDevEnv){var t=s.getItemSession("manageNewPhone");if(!a.isNotNull(t)&&t!=o)return e("#zzu_error").empty().html("新手机号和接收短信验证码手机号不同"),void e("#zzu_captcha_btn").trigger("click");if(!a.isNotNull(n))return e("#zzu_graph_code").val("").focus(),e("#zzu_captcha_btn").trigger("click"),void i("zzu_phone_err","图形验证码不能为空！");if(!a.isNotNull(r))return e("#zzu_phone_code").val("").focus(),void i("zzu_phone_err","手机验证码不能为空！");var l=s.getItemSession("zzu_get_code_manage");if(!a.isNotNull(l))return e("#zzu_captcha_btn").trigger("click"),void e("#zzu_phone_err").empty().html("手机号验证码已失效，请重新发送")}var c={tel:o,sms:r},w=function(a){"1111"==a.code?(s.removeItemSession("manageNewPhone"),e("#zzu_old_phone_input").val("").siblings().val(""),e("#zzu_old_phone").html(o.replace(o.substr(3,5),"*****")),i("zzu_phone_err","修改成功")):(i("zzu_phone_err",a.message),"1011"==a.code&&e("#zzu_phone_code").val("").focus())};s.ajaxUtil("userinfo/modifyMobile.json",c,"POST",w)}),e("#zzu_captcha_img,#zzu_captcha_img").on("click",function(){e("#zzu_captcha_img").attr("src","/i/n/images/captcha.jpg?"+Math.random())}),e("#zzu_captcha_img").trigger("click"),e("#zzu_get_code_manage").on("click",function(){if(!isDevEnv){var _=e("#zzu_old_phone_input").val();if(!a.isPhoneNumber(_))return e("#zzu_old_phone_input").val("").focus(),void i("zzu_phone_err","请正确填写您注册时用的手机号码");var o=e("#zzu_new_phone").val();if(!a.isPhoneNumber(o))return e("#zzu_new_phone").val("").focus(),void i("zzu_phone_err","新手机号码格式不正确");if(o==_)return e("#zzu_new_phone").val("").focus(),void i("zzu_phone_err","新手机号码不能和原手机号相同");var n=e("#zzu_graph_code").val();if(!a.isNotNull(n))return e("#zzu_graph_code").val("").focus(),i("zzu_phone_err","图形验证码不能为空！"),void e("#zzu_captcha_img").trigger("click");var r=function(a){"1111"==a.code?(s.setItemSession("manageNewPhone",o),s.sendValidateSMS(o,"zzu_get_code_manage","zzu_captcha_img")):(s.showMessage(a.message),e("#zzu_captcha_img").trigger("click"))};s.ajaxUtil("n/captcha/check.json",{captcha:n},"POST",r)}}),e("#zzu_update_email").on("click",function(){var _=e("#zzu_old_email").html(),o=e("#zzu_new_email").val();if(a.isEmail(o))if(i("zzu_email_err","验证邮箱可以用来找回密码, 并能享受其他定制服务"),a.isEmail(_)&&_===o)i("zzu_email_err","新邮箱和已绑定的邮箱相同");else{var n={mail:o},r=function(s){e("#zzu_old_email").html(o).siblings().removeClass("zzu-hidden"),"1111"==s.code?(e("#zzu_old_email").html(o),i("zzu_email_err","修改成功")):i("zzu_email_err",s.message)};s.ajaxUtil("userinfo/modifyMail.json",n,"POST",r)}else i("zzu_email_err","邮箱格式不正确")}),e("#zzu_update_wechat").on("click",function(){if(a.isNotNull(o))return void i("zzu_wechat_err","您已经关联过微信号了");var _=e("#zzu_user_wechat").val();if("true"==a.isWeChat(_)){var n=function(s){"1111"==s.code?(e("#zzu_user_wechat").attr("disable","true"),i("zzu_wechat_err","修改成功")):i("zzu_wechat_err",s.message)};s.ajaxUtil("userinfo/updateWeChat.json",{WebChartId:_},"POST",n)}}),e("#zzu_hf_acct").on("click",function(){var e=document.createElement("a");document.body.appendChild(e),e.href=SslUrl+"/hf_public.html#zzu_hf_AcctModify",e.target="_blank",e.click(),document.body.removeChild(e)})});