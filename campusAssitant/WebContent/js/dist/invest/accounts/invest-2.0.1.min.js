define(["jquery","echars-common","common","util/validate","datepicker","datepickerCn","accountsPublic","page","bs"],function(t,a,e,i,s,n){function l(t){if(t){var a="",e=t.indexOf(".");return-1!=e&&(a=t.substr(e,3),t=t.substring(0,e)),t=t.split("").reverse().join("").replace(/(\d{3})/g,"$1,").replace(/\,$/,"").split("").reverse().join(""),t+a}return""}var d,r,o,_="td1",c="desc",m=new Date,v=function(a){var i=t(this).attr("id");t(this).siblings("a").removeClass("active"),status=t("#zzu_status_table").find("a.active").attr("data"),"zzu_begin_time_table"==i&&(r=t(this).val(),o=t("#zzu_end_time_table").val()),"zzu_end_time_table"==i&&(r=t("#zzu_begin_time_table").val(),o=t(this).val());var s=e.datePoor(r,o);return 0>s?void e.showMessage("结束日期不能小于开始日期"):s>11?void e.showMessage("只能查询12个月内的数据"):void u(1,10)};try{t(".zzu-date-control").datepicker({format:"yyyy-mm",autoclose:!0,weekStart:1,startView:1,minView:1,maxView:1,minViewMode:1,forceParse:!1,language:"zh-CN",initialDate:m,endDate:m}).val(m.getFullYear()+"-"+(m.getMonth()+1)).on("change",v)}catch(w){console.log(w)}t(".zzu-querylist").find("a").on("click",function(){var a=t(this).attr("data");i.isNotNull(a)&&(t(this).siblings().removeClass("active"),t(this).addClass("active"),0==a.indexOf("td")&&(_=a,d=t("#zzu_status_table").find("a.active").attr("data"),r=null,o=null),0==a.indexOf("ts")&&(_=t("#zzu_begin_time_table").siblings("a.active").attr("data"),d=a,i.isNotNull(_)||(r=t("#zzu_begin_time_table").val(),o=t("#zzu_end_time_table").val())),u(1,10))});var j=function(){var a=t(this).attr("data");if(a){var i=t("#zzu_"+a+"_detail").attr("class");if(i&&i.indexOf("zzu-hidden")>0){var s=function(t){e.putTemplete("zzu_table_detail_tem",t,"zzu_"+a+"_table")};e.ajaxUtil("invest/investEarningsList.json",{investId:a},"GET",s),t('[id$="_detail"]').slideUp("fast").addClass("zzu-hidden"),t(".zzu-text-link").html("查看"),t("#zzu_"+a+"_detail").slideDown("slow").removeClass("zzu-hidden"),t(this).slideDown(),t(this).html("收起")}else t("#zzu_"+a+"_detail").slideUp("fast").addClass("zzu-hidden"),t(this).html("查看")}},u=function(a,s){t("#loading_animation").show();var n={},l=a||1,m=s||10,v=(l-1)*m,w=m,f={start:v,length:w,columns:[{data:"create_time",name:"create_time",orderable:!0},{data:"LOAD_TITLE",name:"LOAD_TITLE"},{data:"sub_load_id",name:"sub_load_id"},{data:"STAGES_ASSESTS",name:"STAGES_ASSESTS"},{data:"loanTime",name:"loanTime"},{data:"interest_time",name:"interest_time"},{data:"PROFIT",name:"PROFIT"},{data:"balance",name:"balance"},{data:"PAYMENT_USES",name:"PAYMENT_USES"},{data:"STATUS",name:"STATUS"},{data:"can_transfer",name:"can_transfer"},{data:"investStatus",name:"investStatus"},{data:"DISBURSEMENT_PAYMNT_TIME",name:"DISBURSEMENT_PAYMNT_TIME"},{data:"LOAD_ID",name:"LOAD_ID"},{data:"LOANSTATUS",name:"LOANSTATUS"},{data:"INVEST_ID",name:"INVEST_ID"}],order:[{column:"0",dir:c}]};if(n.pageData=JSON.stringify(f),i.isNotNull(_)&&(n.lastestDate=_.substr(2)),i.isNotNull(d)){var b=d.substr(2);"00"!=b&&(n.type=b)}i.isNotNull(r)&&(n.beginDate=r,n.lastestDate=""),i.isNotNull(o)&&(n.endDate=o,n.lastestDate=""),i.isNotNull(c)&&(n.zzu_order=c);var g=function(a){t("#loading_animation").hide(),e.putTemplete("zzu_invest_list_tem",a.data,"zzu_invest_list"),t.zzuPage({pageId:"pageContainer",pageNo:l,pageSize:m,totalCount:a.recordsFiltered,load:u}),t(".zzu-text-link").on("click",j),t("a[id^='zzu_credit_']").on("click",h),t("a[id^='zzu_cancel_credit_']").on("click",function(){var a=t(this).attr("data");t("#invest_id").empty().val(a),t("#zzu_invest-transfer-cancle").modal("show")})};e.ajaxUtil("invest/investList.json",n,"POST",g,function(){t("#loading_animation").hide()})};u(1,10);var h=function(){var a=t(this).attr("data-balance"),i=t(this).attr("data");t("#zzu_invest_id").empty().val(i);var s=t(this).attr("data-loadId"),n={investId:i,loanId:s},d=function(e){if(e){var i=(e.offsetDays,e.not_obtained_interest),s=e.all_not_obtained_interest;t("#zzu_trans_balance").empty().html("￥"+a),t("#zzu_trans_interest").empty().html(i),t("#zzu_trans_remain_interest").empty().html(s);var n=Math.ceil(a/1.1),d=Math.floor(a/.9),r=l(""+n),o=l(""+d);t("#zzu_trans_suggest").empty().html("￥"+r+"&nbsp;至&nbsp;￥"+o),t("#transferFeeRateMisc").empty().html("转让费率，持有60天以上0.2%；持有60天以下0.5%，转让成功时一次性收取，基数为转让价格。"),t("#zzu_invest-transfer-confirm").modal("show")}};e.ajaxUtil("creditassign/nointerest.json",n,"GET",d)};t("#zzu_credit_cancle").click(function(){var a=t("#invest_id").val();f(a)});var f=function(t){var a={investId:t},i=function(t){"1111"==t.code&&window.location.reload()};e.ajaxUtil("creditassign/cancelcredit.json",a,"POST",i)};t("#zzu_trans_ok").click(function(){var a=t("#zzu_invest_id").val(),i=t("#zzu_inv_trans_price").val(),s={investId:a,transAmt:i},n=function(a){alert(a.message),"1111"==a.code&&t("#zzu_invest-transfer-confirm").modal("hide")};e.ajaxUtil("creditassign/commitcredit.json",s,"POST",n)});({rank_two:t("#zzu_rankTwo").val(),rank_one:t("#zzu_rankOne").val()});t(".zzu-table-head").find(".zzu-rank").click(function(){c=t(this).attr("id"),t(this).hide(),t(this).siblings().show(),u(1,10)})});