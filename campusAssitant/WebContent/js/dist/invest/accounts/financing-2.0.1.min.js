define(["jquery","echars-common","common","util/validate","datepicker","datepickerCn","accountsPublic","page","bs"],function(a,t,e,s,i,n){var l,o,d,r="td1",m="desc",_=new Date,w=function(){var t=a(this).attr("id");a(this).siblings("a").removeClass("active");a("#zzu_status_table").find("a.active").attr("data");"zzu_begin_time_table"==t&&(o=a(this).val(),d=a("#zzu_end_time_table").val()),"zzu_end_time_table"==t&&(o=a("#zzu_begin_time_table").val(),d=a(this).val());var s=e.datePoor(o,d);return 0>s?void e.showMessage("结束日期不能小于开始日期"):s>11?void e.showMessage("只能查询12个月内的数据"):void c(1,10)};try{a(".zzu-date-control").datepicker({format:"yyyy-mm",autoclose:!0,weekStart:1,startView:1,minView:1,maxView:1,minViewMode:1,forceParse:!1,language:"zh-CN",initialDate:_,endDate:_}).val(_.getFullYear()+"-"+(_.getMonth()+1)).on("change",w)}catch(p){console.log(p)}a(".zzu-querylist").find("a").on("click",function(){var t=a(this).attr("data");s.isNotNull(t)&&(a(this).siblings().removeClass("active"),a(this).addClass("active"),0==t.indexOf("td")&&(r=t,l=a("#zzu_status_table").find("a.active").attr("data"),o=null,d=null),0==t.indexOf("ts")&&(l=t,r=a("#zzu_begin_time_table").siblings("a.active").attr("data"),s.isNotNull(r)||(o=a("#zzu_begin_time_table").val(),d=a("#zzu_end_time_table").val())),c(1,10))});var u=function(){var t=a(this).attr("data");if(t){var s=a("#zzu_"+t+"_detail").attr("class");if(s&&s.indexOf("zzu-hidden")>0){var i=function(s){e.putTemplete("zzu_table_detail_tem",s,"zzu_"+t+"_table"),a(".zzu-repay").on("click",f)};e.ajaxUtil("repay/repayplan.json",{loadId:t},"GET",i),a('[id$="_detail"]').slideUp("fast").addClass("zzu-hidden"),a(".zzu-show-detail").html("查看"),a("#zzu_"+t+"_detail").slideDown("slow").removeClass("zzu-hidden"),a(this).slideDown(),a(this).html("收起")}else a("#zzu_"+t+"_detail").slideUp("fast").addClass("zzu-hidden"),a(this).html("查看")}},c=function(t,i){a("#loading_animation").show();var n={},_=t||1,w=i||10,p=(_-1)*w,h=w,j={start:p,length:h,columns:[{data:"create_time",name:"create_time",orderable:!0},{data:"load_title",name:"load_title"},{data:"sum",name:"sum"},{data:"payWay",name:"payWay"},{data:"sub_load_id",name:"sub_load_id"},{data:"loanStatus",name:"loanStatus"},{data:"loanTime",name:"loanTime"},{data:"isPrepayment",name:"isPrepayment"},{data:"rate",name:"rate"},{data:"payment_type",name:"payment_type"},{data:"payment_method",name:"payment_method"},{data:"status",name:"status"},{data:"load_id",name:"load_id"},{data:"payment_uses",name:"payment_uses"}],order:[{column:"0",dir:m}]};if(n.pageData=JSON.stringify(j),s.isNotNull(r)&&(n.lastestDate=r.substr(2)),s.isNotNull(l)){var f=l.substr(2);"0"!=f&&(n.type=f)}s.isNotNull(o)&&(n.beginDate=o,n.lastestDate=""),s.isNotNull(d)&&(n.endDate=d,n.lastestDate="");var y=function(t){a("#loading_animation").hide(),e.putTemplete("zzu_invest_list_tem",t.data,"zzu_invest_list"),a.zzuPage({pageId:"pageContainer",pageNo:_,pageSize:w,totalCount:t.recordsFiltered,load:c}),a(".zzu-show-detail").on("click",u),a(".zzu-prepayment").on("click",v)};e.ajaxUtil("financing/list.json",n,"POST",y,function(){a("#loading_animation").hide()})};c(1,10);var h,j,f=function(){h="repayment";var t=a(this).attr("data-load"),e=a(this).attr("data"),s=a(this).attr("data-num");a("#zzu_pass").modal("show"),a("#zzu_pass_input").val(""),a("#zzu_show_error").html(""),j={loadId:t,everyLoadId:e,num:s}},v=function(){h="prepayment";var t=a(this).attr("data"),s=a(this).attr("data-short");j={load_id:t},e.ajaxUtil("repay/prepaymentconfirm.json",j,"POST",function(t){a("#zzu_loan_title").html(s),a("#zzu_payment_times").html(t.payment_times),a("#zzu_surplus_loan").html(t.sum),a("#zzu_default_sum").html(t.defaultSum),a("#zzu_prepay_total_amt").html(t.totalAmt),a("#zzu_prepayment-confirm").modal("show")})};a("#zzu_prepay_ok").on("click",function(){a("#zzu_pass").modal("show"),a("#zzu_pass_input").val(""),a("#zzu_show_error").html("")}),a("#zzu_pass_ok").on("click",function(){var t=a("#zzu_pass_input").val(),i=s.isPas(t);if("true"!=i)return void a("#zzu_show_error").html(i);var n=function(t){a("#zzu_pass_input").val(""),"1111"==t.code?(a("#zzu_pass").modal("hide"),"repayment"==h&&e.ajaxUtil("repay/repayment.json",j,"POST",function(a){e.showMessage(a.message,"info",function(){c(1,10)})}),"prepayment"==h&&e.ajaxUtil("repay/prepayment.json",j,"POST",function(t){a("#zzu_prepayment-confirm").modal("hide"),e.showMessage(t.message,"info",function(){c(1,10)})})):a("#zzu_show_error").html(t.message)};e.ajaxUtil("n/checkUser/isPass.json",{pwd:t},"GET",n)}),a(".zzu-table-head").find(".zzu-rank").click(function(){m=a(this).attr("id"),a(this).hide(),a(this).siblings().show(),c(1,10)})});