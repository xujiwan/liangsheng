define(["jquery","common","util/validate","accountsPublic"],function(e,n,t){function i(i){var r=document.forms[0].radio,o=e("#zzu_cashMin").val(),s=e("#zzu_cashMax").val();if(!t.isNumber(o))return void e(".zzu-error-info").html("请正确输入最小金额");if(!t.isNotNull(o))return void e(".zzu-error-info").html("请输入最小金额");if(50>o)return void e(".zzu-error-info").html("自动投标50元起投");if(!t.isNotNull(s))return void e(".zzu-error-info").html("请输入最大金额");if(!t.isNumber(s))return void e(".zzu-error-info").html("请正确输入最大金额");if(parseFloat(o)>parseFloat(s))return void e(".zzu-error-info").html("最大金额不能小于最小金额");for(var _=0;_<r.length;_++){if(1==r[0].checked)var l=function(e){"1111"==e.code&&n.goUrl("accounts/auto_bid.html")};if(1==r[1].checked){e(".zzu-error-info").html("");var m=e("#most_invest").val();if(!t.isNotNull(m))return void e(".zzu-error-limit-info").html("最多投资金额不能为空");if(50>m)return void e(".zzu-error-limit-info").html("最多投资金额不少于50元");var l=function(e){"1111"==e.code&&n.goUrl("accounts/auto_bid.html")}}}var v={investAmtMin:o,investAmtMax:s,rate:e("#invest_rate").val(),investPeriodMin:e("#invest_period_min").val(),investPeriodMax:e("#invest_period_max").val(),repaymentWay:e("#repayment_way").val(),priority:a(),mostInvest:m,ruleId:i};n.ajaxUtil("autotender/editrule.json",v,"POST",l)}function a(){var n=0,t=parseInt(e("#zzu_cashMax").val()/500);0==t||1==t?n+=2:8>=t?n+=t+1:n=20;var i=e("#invest_rate").val();n+=i>10?5:i>5?15:20;var a=parseInt(e("#invest_period_max").val()/6);switch(a){case 0:n+=3;break;case 1:n+=6;break;case 2:n+=9;break;case 3:n+=12;break;case 4:n+=15;break;default:n+=20}var r="";e("input[name='repayment_way']:checkbox").each(function(){e(this).is(":checked")&&(r+=e(this).val()+",")}),r.length>0&&(n+=r.length>2?20:10);var o=e("#retenion_amount").val();n+=o>=5e3?10:o>=2e3?15:20;var s=parseFloat(e("#totalInvest").val());return n+=s>0?Math.log(s):20}var r,o=window.location.hash,s="";document.forms[0].radio;if(o){s=o.substring(o.indexOf("#")+1,o.lastIndexOf("#"));var _={ruleId:s},l=function(i){var a,o=parseInt(i.RULE_TYPE);switch(o){case 1:a={bidPlan:[{deadline:"少于1个月",earnings:"9%-10%",repayment:"一次性还本付息",invest_rate:9,invest_period_min:0,invest_period_max:0,repayment_way:1,money:i.INVEST_AMT_MIN+"-"+i.INVEST_AMT_MAX,ranking:i.ranking,investment:i.TOTAL_INVEST,maximum:i.MOST_INVEST,rule_type:i.RULE_TYPE,totalInvest:i.TOTAL_INVEST,retenion_amount:i.RETENTION_AMOUNT}]};break;case 2:a={bidPlan:[{deadline:"1-3个月",earnings:"11%-12%",repayment:"等额本息",invest_rate:11,invest_period_min:1,invest_period_max:3,repayment_way:0,money:i.INVEST_AMT_MIN+"-"+i.INVEST_AMT_MAX,ranking:i.ranking,investment:i.TOTAL_INVEST,maximum:i.MOST_INVEST,rule_type:i.RULE_TYPE,totalInvest:i.TOTAL_INVEST,retenion_amount:i.RETENTION_AMOUNT}]};break;case 3:a={bidPlan:[{deadline:"4-6个月",earnings:"13%-14%",repayment:"等额本息",invest_rate:13,invest_period_min:4,invest_period_max:6,repayment_way:0,money:i.INVEST_AMT_MIN+"-"+i.INVEST_AMT_MAX,ranking:i.ranking,investment:i.TOTAL_INVEST,maximum:i.MOST_INVEST,rule_type:i.RULE_TYPE,totalInvest:i.TOTAL_INVEST,retenion_amount:i.RETENTION_AMOUNT}]};break;case 4:a={bidPlan:[{deadline:"7个月以上",earnings:"15%以上",repayment:"等额本息",invest_rate:15,invest_period_min:7,invest_period_max:36,repayment_way:0,money:i.INVEST_AMT_MIN+"-"+i.INVEST_AMT_MAX,ranking:i.ranking,investment:i.TOTAL_INVEST,maximum:i.MOST_INVEST,rule_type:i.RULE_TYPE,totalInvest:i.TOTAL_INVEST,retenion_amount:i.RETENTION_AMOUNT}]}}if(n.putTemplete("zzu_bid_plan_tem",a.bidPlan,"zzu_bid_plan"),t.isNotNull(i.INVEST_AMT_MIN)){var s=parseInt(n.rmoney(i.INVEST_AMT_MIN));e("#zzu_cashMin").val(s)}if(t.isNotNull(i.INVEST_AMT_MAX)){var _=parseInt(n.rmoney(i.INVEST_AMT_MAX));e("#zzu_cashMax").val(_)}if(t.isNotNull(i.MOST_INVEST)&&0!=i.MOST_INVEST){document.getElementById("radio2").checked=!0,e(".zzu-input-text").show();var l=parseInt(n.rmoney(i.MOST_INVEST));r=l,e("#most_invest").val(l)}};n.ajaxUtil("autotender/getrule.json",_,"GET",l),e("#zzu_save").click(function(){i(s)})}e("#radio1").click(function(){e(".zzu-input-text").hide()}),e("#radio2").click(function(){e(".zzu-input-text").show(),e("#most_invest").val(r)}),e("#radio1").click(function(){e("#most_invest").val("")}),e("#zzu_return").on("click",function(){n.goUrl("accounts/auto_bid.html")}),e("#zzu_close_bid").on("click",function(){var e=function(){var e={ruleId:s},t=function(e){var t=e.code;"1111"==t&&n.goUrl("accounts/auto_bid.html")};n.ajaxUtil("autotender/stop.json",e,"POST",t)},t=function(){},i="确定要关闭自动投标吗？";n.showMessage(i,"confirm",e,t)})});